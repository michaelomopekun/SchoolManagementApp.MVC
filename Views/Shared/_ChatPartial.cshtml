<div id="chat-popup-container" style="display: none;">
    <div id="chat-popup" class="chat-popup">
        <div class="chat-header">
            <span id="chat-title">Chat with Lecturer</span>
            <button id="close-chat-popup" class="close-btn">&times;</button>
        </div>
        
        <!-- Lecturer selection dropdown -->
        <div id="lecturer-selection" class="p-3">
            <label for="lecturer-dropdown" class="form-label">Select a lecturer to chat with:</label>
            <select id="lecturer-dropdown" class="form-select">
                <option value="">Loading lecturers...</option>
            </select>
        </div>

        <!-- Chat messages section -->
        <div id="chat-messages" class="chat-content" style="display: none;">
            <div id="message-list"></div>
        </div>

        <div class="chat-footer">
            <div class="chat-input-container">
                <textarea id="chat-input" placeholder="Type a message..." rows="1"></textarea>
                <button id="send-chat-message" class="send-btn" disabled>
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const lecturerDropdown = document.getElementById('lecturer-dropdown');
    const chatMessages = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');
    const sendButton = document.getElementById('send-chat-message');

    async function loadLecturers() {
        try {
            lecturerDropdown.innerHTML = '<option value="">Loading lecturers...</option>';
            
            const response = await fetch('/Chat/GetLecturers');
            const data = await response.json();

            if (data.error) {
                lecturerDropdown.innerHTML = `<option value="" disabled>${data.error}</option>`;
                console.error('Server error:', data.error);
                return;
            }

            lecturerDropdown.innerHTML = '<option value="">Select a lecturer...</option>';
            data.forEach(lecturer => {
                const option = document.createElement('option');
                option.value = lecturer.id;
                option.textContent = `${lecturer.name} - ${lecturer.courseName}`;
                lecturerDropdown.appendChild(option);
            });
        } catch (error) {
            console.error('Error:', error);
            lecturerDropdown.innerHTML = '<option value="" disabled>Failed to load lecturers</option>';
        }
    }

    // Load lecturers when chat is opened
    document.getElementById('open-chat-popup').addEventListener('click', function() {
        loadLecturers();
    });

    // Handle lecturer selection
    lecturerDropdown.addEventListener('change', function() {
        const selected = this.value;
        chatInput.disabled = !selected;
        sendButton.disabled = !selected;
        if (selected) {
            chatMessages.style.display = 'block';
        }
    });
});
</script>